
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.2">
    
    
      
        <title>Notebook 2 - Solar envelope - Spatial Computing Project - Zoho’s Pearl</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.19190aaf.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.24b84193.min.css">
        
          
          
          <meta name="theme-color" content="#ef5552">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../css/ansi-colours.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="red" data-md-color-accent="">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#flowchart" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="Spatial Computing Project - Zoho’s Pearl" class="md-header-nav__button md-logo" aria-label="Spatial Computing Project - Zoho’s Pearl">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Spatial Computing Project - Zoho’s Pearl
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Notebook 2 - Solar envelope
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Spatial Computing Project - Zoho’s Pearl" class="md-nav__button md-logo" aria-label="Spatial Computing Project - Zoho’s Pearl">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Spatial Computing Project - Zoho’s Pearl
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Planning
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Planning" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        Planning
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../a1.1_Process/" class="md-nav__link">
      Process
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../a1.1_Product/" class="md-nav__link">
      Products
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Configuring
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Configuring" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        Configuring
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../a2.1_Process/" class="md-nav__link">
      Process
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../a2.1_Product/" class="md-nav__link">
      Products
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../a2.2_Notebook1/" class="md-nav__link">
      Notebook 1 - Voxelization
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Massing
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Massing" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        Massing
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Notebook 2 - Solar envelope
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Notebook 2 - Solar envelope
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#flowchart" class="md-nav__link">
    Flowchart
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-diagrams" class="md-nav__link">
    Additional diagrams
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pseudo-code" class="md-nav__link">
    Pseudo code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#visualisations-of-the-result" class="md-nav__link">
    Visualisations of the result
  </a>
  
    <nav class="md-nav" aria-label="Visualisations of the result">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gif" class="md-nav__link">
    GIF
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#voxelcloud" class="md-nav__link">
    Voxelcloud
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../a3.2_Notebook3/" class="md-nav__link">
      Notebook 3 - Combine date
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Forming
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Forming" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon"></span>
        Forming
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../a4.2_Notebook4/" class="md-nav__link">
      Notebook 4 - Solar outside
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../a4.2_Notebook5/" class="md-nav__link">
      Notebook 5 - Sound
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../a4.2_Notebook6/" class="md-nav__link">
      Notebook 6 - Scale sound
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../a4.2_Notebook7/" class="md-nav__link">
      Notebook 7 - Roof access
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../a4.2_Notebook8/" class="md-nav__link">
      Notebook 8 - Lower growing resolution
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../a4.2_Notebook9/" class="md-nav__link">
      Notebook 9 - Generative Relations mcda
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../a4.2_Notebook10/" class="md-nav__link">
      Notebook 10 - Raise growing resolution
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../a4.2_Notebook11/" class="md-nav__link">
      Notebook 11 - Prepare for revit pipeline
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../a4.2_Notebook12/" class="md-nav__link">
      Notebook 12 - Generative Relations corridors
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../a4.2_Results/" class="md-nav__link">
      Results
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../a4.3_Renders/" class="md-nav__link">
      Renders
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../about/" class="md-nav__link">
      About
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Index
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Index" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon"></span>
        Index
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../index/scripts/" class="md-nav__link">
      Scripts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../index/figures/" class="md-nav__link">
      Figures
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../index/presentations/" class="md-nav__link">
      Presentations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../index/bibliography/" class="md-nav__link">
      Bibliography
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#flowchart" class="md-nav__link">
    Flowchart
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-diagrams" class="md-nav__link">
    Additional diagrams
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pseudo-code" class="md-nav__link">
    Pseudo code
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#visualisations-of-the-result" class="md-nav__link">
    Visualisations of the result
  </a>
  
    <nav class="md-nav" aria-label="Visualisations of the result">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gif" class="md-nav__link">
    GIF
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#voxelcloud" class="md-nav__link">
    Voxelcloud
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Notebook 2 - Solar envelope</h1>
                
                <p>&nbsp;&nbsp;&nbsp;&nbsp; In the following script, the voxelized envelope, as created in <a href="https://miloumulder.github.io/spatial_computing_project_template/a2.2_Notebook1/">Notebook 1</a>, will be optimized in regards to its shadow footprint or solar envelope. In the first part of this script, the logic is set up to use ladybug and trimesh to shoot rays both from the different sun positions towards the voxels and inverse from voxels towards sun positions. </p>
<hr />
<h2 id="flowchart">Flowchart</h2>
<p>&nbsp;&nbsp;&nbsp;&nbsp;The flowchart as shown in <em><a href="..\img\flowcharts\02_solar_envelope.jpg">Figure 25</a></em> is in the first (purple) section of the <a href="..\img\flowcharts\flowchart cuts.png">fundamental flowchart</a> as shown in the <a href="https://miloumulder.github.io/spatial_computing_project_template/a1.1_Product/#fundamental-flowchart"><em>Planning - products</em></a>.</p>
<figure>
  <img src="..\img\flowcharts\02_solar_envelope.jpg" alt="Flowchart - Solar envelope" style="width:80%; height:80%;">
  <figcaption>Figure 26: Flowchart - Solar envelope</figcaption>
</figure>

<hr />
<h2 id="additional-diagrams">Additional diagrams</h2>
<p><br> &nbsp;&nbsp;&nbsp;&nbsp;Firstly, a Solar access calculation is done with vectors from suns towards the voxels. If these rays intersect with the context mesh they are set to 0. 
 <br> &nbsp;&nbsp;&nbsp;&nbsp; Secondly and more importantly, a solar envelope calculation is done by shooting rays from the voxels towards the sun. Then this list of rays is compared with the list from solar access. <a href="..\img\overige\solar_envelope_1.jpg">Figure 27</a> visualizes how the logic behind the solar envelope works. When an intersection is found at place 2, a shadow is cast on the context. It is important to establish whether this shadow was cast by the voxel or by the context. For this, we use the comparison with the solar access list. If an intersection is found at 1, the shadow is cast by the context. For a ray to count towards the solar envelope of a voxel, an intersection needs to be found at 2 and not at 1. </p>
<figure>
  <img src="..\img\overige\solar_envelope_1.jpg" alt="Visualisation of the process" style="width:40%; height:40%;">
  <figcaption>Figure 27: Visualisation of the process</figcaption>
</figure>

<p>&nbsp;&nbsp;&nbsp;&nbsp;When the solar analysis is done, the list of voxels is split, using a low and high bound threshold value. A threefold of lattices are established in this step: Voxels to recalculate, voxels to keep and voxels to remove. As you can see in <a href="..\img\overige\solar_envelope_2.jpg">Figure 28</a>, the red top part would be removed, the blue recalculated and the green kept.</p>
<figure>
  <img src="..\img\overige\solar_envelope_2.jpg" alt="Visualisation of the grouping of the voxels" style="width:40%; height:40%;">
  <figcaption>Figure 28: Visualisation of the grouping of the voxels</figcaption>
</figure>

<p>&nbsp;&nbsp;&nbsp;&nbsp;The resolution of these lattices are increased to a desired size. In our case one voxel is split into 8 smaller voxels, this is called an Octree system. This whole process can be seen as Pass 1. With the recalculation lattice, the process is repeated until, in our case, the voxel size is 3,6. A total of three passes were needed. 
Each pass is individually exported a CSV or pickled into a txt file.</p>
<hr />
<h2 id="pseudo-code">Pseudo code</h2>
<p>This is the Pseudo code for <a href="notebooks\02_solar_envelope.ipynb">Notebook 2</a>.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">#Import envelope mesh and context mesh</span>
<span class="n">envelope_mesh</span> <span class="o">=</span> <span class="n">envelope</span><span class="o">.</span><span class="n">stl</span>
<span class="n">context_mesh</span> <span class="o">=</span> <span class="n">extended_context_reduced</span><span class="o">.</span><span class="n">stl</span>

<span class="c1">#Visualize meshes with pyvista</span>

<span class="c1">#Import lattice</span>
<span class="n">On</span> <span class="n">first</span> <span class="k">pass</span> <span class="n">lattice</span> <span class="o">=</span> <span class="n">lattice_14_4</span><span class="o">.</span><span class="n">csv</span>
<span class="n">On</span> <span class="n">subsequent</span> <span class="n">passes</span> <span class="n">lattice</span> <span class="o">=</span> <span class="n">lattice_continue</span><span class="o">.</span><span class="n">csv</span>

<span class="c1">#Visualize lattice with pyvista</span>

<span class="c1">#Define Sunpath</span>
<span class="n">Choose</span> <span class="n">day_multiple</span> <span class="n">carefully</span><span class="p">,</span> <span class="n">between</span> <span class="mi">15</span> <span class="ow">and</span> <span class="mi">75</span>
<span class="n">Compute</span> <span class="n">the</span> <span class="n">sun_vectors</span> <span class="n">to</span> <span class="n">shoot</span>
<span class="n">Visualize</span> <span class="n">suns</span> <span class="k">with</span> <span class="n">pyvista</span>

<span class="c1">#Compute intersections</span>
<span class="n">Create</span> <span class="n">two</span> <span class="n">seperate</span> <span class="n">lists</span> <span class="k">for</span> <span class="n">ray</span> <span class="n">direction</span> <span class="k">for</span> <span class="n">envelope</span> <span class="ow">and</span> <span class="n">access</span>
<span class="n">Check</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">rays</span> <span class="n">carefully</span><span class="p">,</span> <span class="n">should</span> <span class="n">definetly</span> <span class="n">be</span> <span class="n">under</span> <span class="mi">120</span><span class="n">k</span> <span class="ow">and</span> <span class="n">ideally</span> <span class="n">under</span> <span class="mi">100</span><span class="n">k</span>

<span class="n">Compute</span> <span class="n">the</span> <span class="n">intersections</span> <span class="k">for</span> <span class="n">solar_acces</span>
<span class="n">Compute</span> <span class="n">the</span> <span class="n">intersections</span> <span class="k">for</span> <span class="n">solar_envelope</span>

<span class="c1">#Aggregate Simulation results</span>
<span class="n">Translate</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">rays</span> <span class="k">with</span> <span class="mi">1</span> <span class="ow">or</span> <span class="mi">0</span> <span class="n">on</span> <span class="n">hit</span> <span class="ow">or</span> <span class="n">miss</span> <span class="n">to</span> <span class="n">a</span> <span class="n">value</span> <span class="n">per</span> <span class="n">voxel</span><span class="o">.</span>
<span class="n">For</span> <span class="n">solar</span> <span class="n">envelope</span> <span class="n">check</span> <span class="k">if</span> <span class="n">shadow</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">cast</span> <span class="n">by</span> <span class="n">context</span> <span class="n">by</span> <span class="n">comparing</span> <span class="n">the</span> <span class="n">acces</span> <span class="ow">and</span> <span class="n">envelope</span> <span class="n">lists</span>

<span class="c1">#Save solar information to an array</span>
<span class="n">Iterate</span> <span class="n">over</span> <span class="n">each</span> <span class="n">voxel</span> <span class="ow">and</span> <span class="n">add</span> <span class="n">its</span> <span class="n">solar</span> <span class="n">acces</span> <span class="ow">and</span> <span class="n">envelope</span> <span class="n">value</span>

<span class="c1">#Visualize solar acces and envelope with pyvista</span>

<span class="c1">#Save solar data to a csv</span>
<span class="n">write</span> <span class="n">solar</span> <span class="n">access</span> <span class="n">to</span> <span class="s1">&#39;solar_acces_(current voxel size).csv&#39;</span>
<span class="n">write</span> <span class="n">solar</span> <span class="n">envelope</span> <span class="n">to</span> <span class="s1">&#39;solar_envelope_(current voxel size).csv&#39;</span>

<span class="c1">#Initialize Variables</span>
<span class="n">voxel</span> <span class="n">sizes</span><span class="p">:</span>
    <span class="n">current</span>
    <span class="n">required</span> 
    <span class="n">final</span>
<span class="n">Treshold</span> <span class="n">values</span><span class="p">:</span>
    <span class="n">low</span> <span class="n">bound</span>
    <span class="n">high</span> <span class="n">bound</span>
<span class="n">Shape</span><span class="p">:</span>
    <span class="n">current</span> <span class="n">lattice</span> <span class="n">height</span>
    <span class="n">current</span> <span class="n">lattice</span> <span class="n">length</span>
    <span class="n">current</span> <span class="n">lattice</span> <span class="n">width</span>

<span class="c1">#Initialize Envelope CSV</span>
<span class="n">import</span><span class="p">:</span> <span class="n">current</span> <span class="n">size</span> <span class="n">solar</span> <span class="n">Envelope</span>
    <span class="n">read</span> <span class="n">shape</span> <span class="n">via</span> <span class="n">lattice</span>
    <span class="n">read</span> <span class="n">data</span> <span class="k">with</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span>
<span class="n">CSV</span> <span class="n">useable</span><span class="p">:</span>
    <span class="n">Convert</span> <span class="n">strings</span> <span class="n">to</span> <span class="nb">int</span> <span class="n">where</span> <span class="n">possible</span>
    <span class="n">Remove</span> <span class="n">empty</span> <span class="n">lists</span>
    <span class="n">Arrange</span> <span class="ow">in</span> <span class="n">Lattice</span> <span class="n">shape</span>

<span class="c1">#Use Tresholds to split data</span>
<span class="n">For</span> <span class="n">each</span> <span class="n">voxel</span>
    <span class="k">if</span> <span class="n">the</span> <span class="n">envelope</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">between</span> <span class="n">the</span> <span class="n">Tresholds</span>
        <span class="n">Scale</span> <span class="n">voxel</span> <span class="n">to</span> <span class="n">the</span> <span class="n">required</span> <span class="n">size</span> <span class="ow">and</span> <span class="n">add</span> <span class="n">to</span> <span class="n">recalculate</span> <span class="n">coords</span>

    <span class="k">elif</span> <span class="n">the</span> <span class="n">envelope</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">between</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">high</span> <span class="n">bound</span>
        <span class="n">Scale</span> <span class="n">voxel</span> <span class="n">to</span> <span class="n">the</span> <span class="n">required</span> <span class="n">size</span> <span class="ow">and</span> <span class="n">add</span> <span class="n">to</span> <span class="n">keep</span> <span class="n">coords</span>

    <span class="k">elif</span> <span class="n">the</span> <span class="n">envelope</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">greater</span> <span class="n">than</span> <span class="n">the</span> <span class="n">high</span> <span class="n">bound</span>
        <span class="n">Scale</span> <span class="n">voxels</span> <span class="n">to</span> <span class="n">the</span> <span class="n">required</span> <span class="n">size</span> <span class="ow">and</span> <span class="n">add</span> <span class="n">to</span> <span class="n">remove</span> <span class="n">coords</span>

<span class="c1">#Find the min and max of keep coords per x,y coordinate</span>
<span class="n">For</span> <span class="n">each</span> <span class="n">x</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">keep</span> <span class="n">coords</span>
    <span class="k">if</span> <span class="n">voxel</span> <span class="ow">is</span> <span class="ow">in</span> <span class="n">keep</span> <span class="n">coords</span>
        <span class="n">add</span> <span class="n">z</span> <span class="n">to</span> <span class="n">temp_list</span>
    <span class="n">find</span> <span class="nb">min</span> <span class="ow">and</span> <span class="nb">max</span> <span class="ow">in</span> <span class="n">temp_list</span> <span class="n">add</span> <span class="k">with</span> <span class="n">x</span> <span class="n">y</span> <span class="n">to</span> <span class="n">min_max_list</span> <span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">min_z</span><span class="p">,</span><span class="n">max_z</span><span class="p">])</span>

<span class="c1">#Establish seperate lists for x y and min max</span>
<span class="n">For</span> <span class="n">each</span> <span class="nb">list</span> <span class="ow">in</span> <span class="n">min_max_list</span>
    <span class="n">add</span> <span class="n">x</span> <span class="n">y</span> <span class="n">to</span> <span class="n">min_max_coords</span>
    <span class="n">add</span> <span class="nb">min</span> <span class="nb">max</span> <span class="n">to</span> <span class="n">min_max_values</span>

<span class="c1">#Fill any voxel between the max and min</span>
<span class="n">For</span> <span class="n">each</span> <span class="nb">list</span> <span class="ow">in</span> <span class="n">min_max_list</span>
    <span class="n">For</span> <span class="n">each</span> <span class="n">z</span> <span class="n">value</span> <span class="n">between</span> <span class="nb">min</span> <span class="ow">and</span> <span class="nb">max</span>
        <span class="n">add</span> <span class="n">coordinates</span> <span class="n">to</span> <span class="n">calculate_coords</span>

<span class="c1">#Use a list of all voxels under the high bound to find which to keep</span>
<span class="n">establish</span> <span class="n">full_coords</span> <span class="k">as</span> <span class="n">combination</span> <span class="n">of</span> <span class="n">recalculate</span> <span class="n">coords</span> <span class="ow">and</span> <span class="n">keep</span> <span class="n">coords</span>

<span class="k">for</span> <span class="n">each</span> <span class="n">voxel</span> <span class="ow">in</span> <span class="n">full_coords</span>
    <span class="k">if</span> <span class="n">x</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">in</span> <span class="n">min_max_values</span>
        <span class="n">find</span> <span class="n">the</span> <span class="n">index</span> <span class="n">of</span> <span class="n">x</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">min_max_values</span>
        <span class="n">use</span> <span class="n">index</span> <span class="n">to</span> <span class="n">find</span> <span class="nb">min</span> <span class="nb">max</span>

        <span class="k">if</span> <span class="n">z</span> <span class="ow">is</span> <span class="n">greater</span> <span class="n">than</span> <span class="n">the</span> <span class="nb">min</span> <span class="n">value</span>
            <span class="n">add</span> <span class="n">this</span> <span class="n">index</span> <span class="n">to</span> <span class="n">a</span> <span class="n">pop_list</span>

<span class="n">establish</span> <span class="n">final_coords</span> <span class="k">as</span> <span class="n">full_coords</span> <span class="k">with</span> <span class="n">both</span> <span class="n">pop_list</span> <span class="ow">and</span> <span class="n">remove</span> <span class="n">coords</span> <span class="n">removed</span>

<span class="n">Scale</span> <span class="n">the</span> <span class="n">final_coords</span> <span class="n">voxels</span> <span class="n">to</span> <span class="n">the</span> <span class="n">final</span> <span class="n">size</span>


<span class="c1">#Use the largest size voxel csv as basis for translation</span>
<span class="n">Import</span> <span class="n">the</span> <span class="n">CSV</span>
    <span class="n">read</span> <span class="n">data</span> <span class="k">with</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span>
<span class="n">CSV</span> <span class="n">useable</span><span class="p">:</span>
    <span class="n">Convert</span> <span class="n">strings</span> <span class="n">to</span> <span class="nb">int</span> <span class="n">where</span> <span class="n">possible</span>
    <span class="n">Remove</span> <span class="n">empty</span> <span class="n">lists</span>
    <span class="n">Place</span> <span class="n">top</span> <span class="n">lines</span> <span class="n">into</span> <span class="n">top_csv</span>
    <span class="n">Place</span> <span class="n">rest</span> <span class="n">of</span> <span class="n">the</span> <span class="n">lines</span> <span class="n">into</span> <span class="n">rest_csv</span>

<span class="c1">#Translate the current solar data to the final resolution</span>
<span class="n">using</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span> <span class="n">upscale</span> <span class="n">the</span> <span class="n">solar</span> <span class="n">acces</span> <span class="ow">and</span> <span class="n">envelope</span>
<span class="n">pickle</span> <span class="n">solar</span> <span class="n">envelope</span> <span class="n">to</span> <span class="s1">&#39;solar_envelope_pass_(num).txt&#39;</span>
<span class="n">pickle</span> <span class="n">solar</span> <span class="n">access</span> <span class="n">to</span> <span class="s1">&#39;solar_access_pass_(num).txt&#39;</span>

<span class="c1">#Use final_coords to create a list of final size voxels to print after this pass</span>
<span class="n">For</span> <span class="n">each</span> <span class="n">top_csv</span> <span class="n">lines</span>
    <span class="nb">set</span> <span class="n">both</span> <span class="n">the</span> <span class="n">shape</span> <span class="ow">and</span> <span class="n">size</span> <span class="n">correct</span>

<span class="n">Scale</span> <span class="n">the</span> <span class="n">rest_csv</span> <span class="n">voxels</span> <span class="n">into</span> <span class="n">the</span> <span class="n">final</span> <span class="n">size</span>
<span class="n">Set</span> <span class="n">each</span> <span class="n">boolean</span> <span class="n">to</span> <span class="n">false</span>

<span class="n">For</span> <span class="n">each</span> <span class="n">voxel</span> <span class="ow">in</span> <span class="n">final_coords</span>
    <span class="k">if</span> <span class="n">the</span> <span class="n">voxel</span> <span class="ow">is</span> <span class="n">also</span> <span class="ow">in</span> <span class="n">rest_csv</span>
        <span class="nb">set</span> <span class="n">the</span> <span class="n">boolean</span> <span class="n">to</span> <span class="kc">True</span>

<span class="n">Establish</span> <span class="n">final_result</span> <span class="k">as</span> <span class="n">the</span> <span class="n">combination</span> <span class="n">of</span> <span class="n">top_csv</span> <span class="ow">and</span> <span class="n">rest_csv</span>

<span class="c1">#Repeat this process for the voxels in calculate_coords</span>
<span class="n">For</span> <span class="n">each</span> <span class="n">top_csv</span> <span class="n">lines</span>
    <span class="nb">set</span> <span class="n">both</span> <span class="n">the</span> <span class="n">shape</span> <span class="ow">and</span> <span class="n">size</span> <span class="n">correct</span>

<span class="n">Scale</span> <span class="n">the</span> <span class="n">rest_csv</span> <span class="n">voxels</span> <span class="n">into</span> <span class="n">the</span> <span class="n">final</span> <span class="n">size</span>
<span class="n">Set</span> <span class="n">each</span> <span class="n">boolean</span> <span class="n">to</span> <span class="n">false</span>

<span class="n">For</span> <span class="n">each</span> <span class="n">voxel</span> <span class="ow">in</span> <span class="n">final_coords</span>
    <span class="k">if</span> <span class="n">the</span> <span class="n">voxel</span> <span class="ow">is</span> <span class="n">also</span> <span class="ow">in</span> <span class="n">rest_csv</span>
        <span class="nb">set</span> <span class="n">the</span> <span class="n">boolean</span> <span class="n">to</span> <span class="kc">True</span>

<span class="n">Establish</span> <span class="n">calculate_result</span> <span class="k">as</span> <span class="n">the</span> <span class="n">combination</span> <span class="n">of</span> <span class="n">top_csv</span> <span class="ow">and</span> <span class="n">rest_csv</span>

<span class="n">Write</span> <span class="n">final_result</span> <span class="n">to</span> <span class="s1">&#39;lattice_print_pass_(num).txt&#39;</span> <span class="k">with</span> <span class="n">proper</span> <span class="n">enters</span>
<span class="n">Write</span> <span class="n">calculate_result</span> <span class="n">to</span> <span class="s1">&#39;lattice_continue.txt&#39;</span> <span class="k">with</span> <span class="n">proper</span> <span class="n">enters</span>
</code></pre></div>

<hr />
<h2 id="visualisations-of-the-result">Visualisations of the result</h2>
<h3 id="gif">GIF</h3>
<figure>
  <img src="..\img\gifjes\02_solar_envelope.gif" alt="GIF - Solar envelope" style="width:80%; height:80%;">
  <figcaption>Figure 29: GIF - Solar envelope </figcaption>
</figure>

<h3 id="voxelcloud">Voxelcloud</h3>
<p>1) This is the first solar envelope done on a voxel size of 14,4.</p>
<figure>
  <img src="..\img\overige\solar_envelope_3.jpg" alt="Solar envelope - size 14,4" style="width:80%; height:80%;">
  <figcaption>Figure 30: Solar envelope - size 14,4</figcaption>
</figure>

<p>2) The visible voxels are kept.</p>
<figure>
  <img src="..\img\overige\solar_envelope_4.jpg" alt="Selection 1" style="width:80%; height:80%;">
  <figcaption>Figure 31: Selection 1</figcaption>
</figure>

<p>3) The smaller voxels added back to the model are recalculated at size 7,2.</p>
<figure>
  <img src="..\img\overige\solar_envelope_5.jpg" alt="Selection 1 + voxels in size 7,2" style="width:80%; height:80%;">
  <figcaption>Figure 32: Selection 1 + voxels in size 7,2</figcaption>
</figure>

<p>4) These voxels are kept.</p>
<figure>
  <img src="..\img\overige\solar_envelope_6.jpg" alt="Selection 2" style="width:80%; height:80%;">
  <figcaption>Figure 33: Selection 2</figcaption>
</figure>

<p>5) Again the voxel size is reduced and the visualised part is recalculated.</p>
<figure>
  <img src="..\img\overige\solar_envelope_7.jpg" alt="Selection 2 + voxels in size 3,6" style="width:80%; height:80%;">
  <figcaption>Figure 34: Selection 2 + voxels in size 3,6</figcaption>
</figure>

<p>6) The end result.</p>
<figure>
  <img src="..\img\overige\solar_envelope_8.jpg" alt="Final result" style="width:80%; height:80%;">
  <figcaption>Figure 35: Final result</figcaption>
</figure>
                
                  
                    

<hr>
<div class="md-source-date">
  <small>
    
      Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">January 27, 2021</span>
    
  </small>
</div>
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../a2.2_Notebook1/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Notebook 1 - Voxelization
              </div>
            </div>
          </a>
        
        
          <a href="../a3.2_Notebook3/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Notebook 3 - Combine date
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.7e0ee788.min.js"></script>
      <script src="../assets/javascripts/bundle.c1ccee15.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: ['search'],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>